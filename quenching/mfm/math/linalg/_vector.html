<!DOCTYPE html>
<!-- Generated by Cython 0.20.1 on Mon Sep 29 18:54:04 2014 -->
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">

body { font-family: courier; font-size: 12; }

.code  { font-size: 9; color: #444444; display: none; margin-left: 20px; }
.py_c_api  { color: red; }
.py_macro_api  { color: #FF7000; }
.pyx_c_api  { color: #FF3000; }
.pyx_macro_api  { color: #FF7000; }
.refnanny  { color: #FFA000; }

.error_goto  { color: #FFA000; }

.tag  {  }

.coerce  { color: #008000; border: 1px dotted #008000 }

.py_attr { color: #FF0000; font-weight: bold; }
.c_attr  { color: #0000FF; }

.py_call { color: #FF0000; font-weight: bold; }
.c_call  { color: #0000FF; }

.line { margin: 0em }

</style>
<script>
function toggleDiv(id) {
    theDiv = document.getElementById(id);
    if (theDiv.style.display != 'block') theDiv.style.display = 'block';
    else theDiv.style.display = 'none';
}
</script>
</head>
        <body>
<p>Generated by Cython 0.20.1 on Mon Sep 29 18:54:04 2014
<p>Raw output: <a href="_vector.c">_vector.c</a>
<pre class='line' style='background-color: #FFFF57' onclick='toggleDiv("line1")'> 1: import numpy as np</pre>
<pre id='line1' class='code' style='background-color: #FFFF57'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
/* … */
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 1; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line2")'> 2: cimport numpy as np</pre>
<pre id='line2' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line3")'> 3: from libc.math cimport exp, ceil, acos, acos, sqrt, atan2, sin, cos</pre>
<pre id='line3' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line4")'> 4: cimport cython</pre>
<pre id='line4' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line5")'> 5: from cython.parallel import parallel, prange</pre>
<pre id='line5' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line6")'> 6: </pre>
<pre id='line6' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line7")'> 7: @cython.boundscheck(False)</pre>
<pre id='line7' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line8")'> 8: cdef inline double norm3c(double[:] v):</pre>
<pre id='line8' class='code' style='background-color: #FFFFff'>static CYTHON_INLINE double __pyx_f_3lib_4math_6linalg_7_vector_norm3c(__Pyx_memviewslice __pyx_v_v) {
  double __pyx_v_sum;
  int __pyx_v_k;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("norm3c", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line9")'> 9:     """</pre>
<pre id='line9' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line10")'> 10:     :param v: 1D numpy-array</pre>
<pre id='line10' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line11")'> 11:     :return: normalized numpy-array</pre>
<pre id='line11' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line12")'> 12:     """</pre>
<pre id='line12' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line13")'> 13:     cdef double sum = 0.0</pre>
<pre id='line13' class='code' style='background-color: #FFFFff'>  __pyx_v_sum = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line14")'> 14:     cdef int k</pre>
<pre id='line14' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line15")'> 15:     for k in xrange(3):</pre>
<pre id='line15' class='code' style='background-color: #FFFFff'>  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 3; __pyx_t_1+=1) {
    __pyx_v_k = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line16")'> 16:         sum += v[k]*v[k]</pre>
<pre id='line16' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = __pyx_v_k;
    if (__pyx_t_2 &lt; 0) __pyx_t_2 += __pyx_v_v.shape[0];
    __pyx_t_3 = __pyx_v_k;
    if (__pyx_t_3 &lt; 0) __pyx_t_3 += __pyx_v_v.shape[0];
    __pyx_v_sum = (__pyx_v_sum + ((*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_2 * __pyx_v_v.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_3 * __pyx_v_v.strides[0]) )))));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line17")'> 17:     return sqrt(sum)</pre>
<pre id='line17' class='code' style='background-color: #FFFFff'>  __pyx_r = sqrt(__pyx_v_sum);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line18")'> 18: </pre>
<pre id='line18' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line19")'> 19: @cython.boundscheck(False)</pre>
<pre id='line19' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line20")'> 20: def dist(double[:] u, double[:] v):</pre>
<pre id='line20' class='code' style='background-color: #FFFF29'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_1dist(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3lib_4math_6linalg_7_vector_dist[] = "\n    Distance between two vectors\n\n    :param u:\n    :param v:\n    :return:\n    ";
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_1dist = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("dist"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_1dist, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3lib_4math_6linalg_7_vector_dist)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_1dist(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_u = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_v = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dist (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_u,&amp;__pyx_n_s_v,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_u)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dist", 1, 2, 2, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dist") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_u = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_u.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_v = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_v.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dist", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.dist", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_dist(__pyx_self, __pyx_v_u, __pyx_v_v);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_dist(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_u, __Pyx_memviewslice __pyx_v_v) {
  int __pyx_v_i;
  float __pyx_v_d2;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dist", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.dist", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_u, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_v, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__24 = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_n_s_u, __pyx_n_s_v, __pyx_n_s_i, __pyx_n_s_d2);<span class='error_goto'> if (unlikely(!__pyx_tuple__24)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__24);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__24);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_1dist, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_dist, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__25 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__24, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_dist, 20, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__25)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 20; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line21")'> 21:     """</pre>
<pre id='line21' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line22")'> 22:     Distance between two vectors</pre>
<pre id='line22' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line23")'> 23: </pre>
<pre id='line23' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line24")'> 24:     :param u:</pre>
<pre id='line24' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line25")'> 25:     :param v:</pre>
<pre id='line25' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line26")'> 26:     :return:</pre>
<pre id='line26' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line27")'> 27:     """</pre>
<pre id='line27' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line28")'> 28:     cdef int i</pre>
<pre id='line28' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line29")'> 29:     cdef float d2</pre>
<pre id='line29' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line30")'> 30:     d2 = 0.0</pre>
<pre id='line30' class='code' style='background-color: #FFFFff'>  __pyx_v_d2 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line31")'> 31:     for i in range(u.shape[0]):</pre>
<pre id='line31' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_u.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line32")'> 32:         d2 += (u[i]-v[i])*(u[i]-v[i])</pre>
<pre id='line32' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = __pyx_v_i;
    if (__pyx_t_3 &lt; 0) __pyx_t_3 += __pyx_v_u.shape[0];
    __pyx_t_4 = __pyx_v_i;
    if (__pyx_t_4 &lt; 0) __pyx_t_4 += __pyx_v_v.shape[0];
    __pyx_t_5 = __pyx_v_i;
    if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_u.shape[0];
    __pyx_t_6 = __pyx_v_i;
    if (__pyx_t_6 &lt; 0) __pyx_t_6 += __pyx_v_v.shape[0];
    __pyx_v_d2 = (__pyx_v_d2 + (((*((double *) ( /* dim=0 */ (__pyx_v_u.data + __pyx_t_3 * __pyx_v_u.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_4 * __pyx_v_v.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_u.data + __pyx_t_5 * __pyx_v_u.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_6 * __pyx_v_v.strides[0]) ))))));
  }
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line33")'> 33:     return sqrt(d2)</pre>
<pre id='line33' class='code' style='background-color: #FFFF9f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(sqrt(__pyx_v_d2));<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 33; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_r = __pyx_t_7;
  __pyx_t_7 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line34")'> 34: </pre>
<pre id='line34' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line35")'> 35: @cython.boundscheck(False)</pre>
<pre id='line35' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line36")'> 36: def dist2(double[:] u, double[:] v):</pre>
<pre id='line36' class='code' style='background-color: #FFFF29'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_3dist2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3lib_4math_6linalg_7_vector_2dist2[] = "\n    Squared distance between two vectors\n    :param u:\n    :param v:\n    :return:\n    ";
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_3dist2 = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("dist2"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_3dist2, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3lib_4math_6linalg_7_vector_2dist2)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_3dist2(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_u = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_v = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dist2 (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_u,&amp;__pyx_n_s_v,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_u)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_v)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dist2", 1, 2, 2, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dist2") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_u = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_u.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_v = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_v.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dist2", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.dist2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_2dist2(__pyx_self, __pyx_v_u, __pyx_v_v);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_2dist2(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_u, __Pyx_memviewslice __pyx_v_v) {
  int __pyx_v_i;
  float __pyx_v_d2;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dist2", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.dist2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_u, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_v, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__26 = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_n_s_u, __pyx_n_s_v, __pyx_n_s_i, __pyx_n_s_d2);<span class='error_goto'> if (unlikely(!__pyx_tuple__26)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__26);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__26);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_3dist2, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_dist2, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__27 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__26, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_dist2, 36, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__27)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 36; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line37")'> 37:     """</pre>
<pre id='line37' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line38")'> 38:     Squared distance between two vectors</pre>
<pre id='line38' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line39")'> 39:     :param u:</pre>
<pre id='line39' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line40")'> 40:     :param v:</pre>
<pre id='line40' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line41")'> 41:     :return:</pre>
<pre id='line41' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line42")'> 42:     """</pre>
<pre id='line42' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line43")'> 43:     cdef int i</pre>
<pre id='line43' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line44")'> 44:     cdef float d2</pre>
<pre id='line44' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line45")'> 45:     d2 = 0.0</pre>
<pre id='line45' class='code' style='background-color: #FFFFff'>  __pyx_v_d2 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line46")'> 46:     for i in range(u.shape[0]):</pre>
<pre id='line46' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_u.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_i = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line47")'> 47:         d2 += (u[i]-v[i])*(u[i]-v[i])</pre>
<pre id='line47' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = __pyx_v_i;
    if (__pyx_t_3 &lt; 0) __pyx_t_3 += __pyx_v_u.shape[0];
    __pyx_t_4 = __pyx_v_i;
    if (__pyx_t_4 &lt; 0) __pyx_t_4 += __pyx_v_v.shape[0];
    __pyx_t_5 = __pyx_v_i;
    if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_u.shape[0];
    __pyx_t_6 = __pyx_v_i;
    if (__pyx_t_6 &lt; 0) __pyx_t_6 += __pyx_v_v.shape[0];
    __pyx_v_d2 = (__pyx_v_d2 + (((*((double *) ( /* dim=0 */ (__pyx_v_u.data + __pyx_t_3 * __pyx_v_u.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_4 * __pyx_v_v.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_u.data + __pyx_t_5 * __pyx_v_u.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_6 * __pyx_v_v.strides[0]) ))))));
  }
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line48")'> 48:     return d2</pre>
<pre id='line48' class='code' style='background-color: #FFFF9f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_d2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 48; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_r = __pyx_t_7;
  __pyx_t_7 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line49")'> 49: </pre>
<pre id='line49' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line50")'> 50: @cython.boundscheck(False)</pre>
<pre id='line50' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line51")'> 51: cdef double distc(double[:] u, double[:] v):</pre>
<pre id='line51' class='code' style='background-color: #FFFFff'>static double __pyx_f_3lib_4math_6linalg_7_vector_distc(__Pyx_memviewslice __pyx_v_u, __Pyx_memviewslice __pyx_v_v) {
  int __pyx_v_i;
  double __pyx_v_d2;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("distc", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line52")'> 52:     cdef int i</pre>
<pre id='line52' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line53")'> 53:     cdef double d2</pre>
<pre id='line53' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line54")'> 54:     d2 = 0.0</pre>
<pre id='line54' class='code' style='background-color: #FFFFff'>  __pyx_v_d2 = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line55")'> 55:     for i in range(3):</pre>
<pre id='line55' class='code' style='background-color: #FFFFff'>  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 3; __pyx_t_1+=1) {
    __pyx_v_i = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line56")'> 56:         d2 += (u[i]-v[i])*(u[i]-v[i])</pre>
<pre id='line56' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = __pyx_v_i;
    if (__pyx_t_2 &lt; 0) __pyx_t_2 += __pyx_v_u.shape[0];
    __pyx_t_3 = __pyx_v_i;
    if (__pyx_t_3 &lt; 0) __pyx_t_3 += __pyx_v_v.shape[0];
    __pyx_t_4 = __pyx_v_i;
    if (__pyx_t_4 &lt; 0) __pyx_t_4 += __pyx_v_u.shape[0];
    __pyx_t_5 = __pyx_v_i;
    if (__pyx_t_5 &lt; 0) __pyx_t_5 += __pyx_v_v.shape[0];
    __pyx_v_d2 = (__pyx_v_d2 + (((*((double *) ( /* dim=0 */ (__pyx_v_u.data + __pyx_t_2 * __pyx_v_u.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_3 * __pyx_v_v.strides[0]) )))) * ((*((double *) ( /* dim=0 */ (__pyx_v_u.data + __pyx_t_4 * __pyx_v_u.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_5 * __pyx_v_v.strides[0]) ))))));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line57")'> 57:     return sqrt(d2)</pre>
<pre id='line57' class='code' style='background-color: #FFFFff'>  __pyx_r = sqrt(__pyx_v_d2);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line58")'> 58: </pre>
<pre id='line58' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line59")'> 59: </pre>
<pre id='line59' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line60")'> 60: @cython.boundscheck(False)</pre>
<pre id='line60' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line61")'> 61: def norm(double[:] v):</pre>
<pre id='line61' class='code' style='background-color: #FFFF4f'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_5norm(PyObject *__pyx_self, PyObject *__pyx_arg_v); /*proto*/
static char __pyx_doc_3lib_4math_6linalg_7_vector_4norm[] = "\n    Euclidean  norm of a vector\n\n    :param v: 1D numpy-array\n    :return: normalized numpy-array\n    ";
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_5norm = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("norm"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_5norm, METH_O, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3lib_4math_6linalg_7_vector_4norm)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_5norm(PyObject *__pyx_self, PyObject *__pyx_arg_v) {
  __Pyx_memviewslice __pyx_v_v = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("norm (wrapper)", 0);
  assert(__pyx_arg_v); {
    __pyx_v_v = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_arg_v);<span class='error_goto'> if (unlikely(!__pyx_v_v.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.norm", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_4norm(__pyx_self, __pyx_v_v);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_4norm(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_v) {
  double __pyx_v_sum;
  int __pyx_v_k;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("norm", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.norm", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_v, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__28 = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_n_s_v, __pyx_n_s_v, __pyx_n_s_sum, __pyx_n_s_k);<span class='error_goto'> if (unlikely(!__pyx_tuple__28)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__28);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__28);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_5norm, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_norm, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__29 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(1, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__28, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_norm, 61, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__29)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 61; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line62")'> 62:     """</pre>
<pre id='line62' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line63")'> 63:     Euclidean  norm of a vector</pre>
<pre id='line63' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line64")'> 64: </pre>
<pre id='line64' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line65")'> 65:     :param v: 1D numpy-array</pre>
<pre id='line65' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line66")'> 66:     :return: normalized numpy-array</pre>
<pre id='line66' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line67")'> 67:     """</pre>
<pre id='line67' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line68")'> 68:     cdef double sum = 0.0</pre>
<pre id='line68' class='code' style='background-color: #FFFFff'>  __pyx_v_sum = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line69")'> 69:     cdef int k</pre>
<pre id='line69' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line70")'> 70:     for k in xrange(v.shape[0]):</pre>
<pre id='line70' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_v.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_k = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line71")'> 71:         sum += v[k]*v[k]</pre>
<pre id='line71' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = __pyx_v_k;
    if (__pyx_t_3 &lt; 0) __pyx_t_3 += __pyx_v_v.shape[0];
    __pyx_t_4 = __pyx_v_k;
    if (__pyx_t_4 &lt; 0) __pyx_t_4 += __pyx_v_v.shape[0];
    __pyx_v_sum = (__pyx_v_sum + ((*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_3 * __pyx_v_v.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_v.data + __pyx_t_4 * __pyx_v_v.strides[0]) )))));
  }
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line72")'> 72:     return sqrt(sum)</pre>
<pre id='line72' class='code' style='background-color: #FFFF9f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(sqrt(__pyx_v_sum));<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 72; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line73")'> 73: </pre>
<pre id='line73' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line74")'> 74: @cython.boundscheck(False)</pre>
<pre id='line74' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF29' onclick='toggleDiv("line75")'> 75: def dot(double[:] a, double[:] b):</pre>
<pre id='line75' class='code' style='background-color: #FFFF29'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_7dot(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3lib_4math_6linalg_7_vector_6dot[] = "\n    Vector product of two vectors.\n\n    :param a: 1D numpy-array\n    :param b: 1D numpy-array\n    :return: dot-product of the two numpy arrays\n    ";
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_7dot = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("dot"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_7dot, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3lib_4math_6linalg_7_vector_6dot)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_7dot(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_a = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_b = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dot (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_a,&amp;__pyx_n_s_b,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_b)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dot", 1, 2, 2, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dot") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_a = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_a.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_b = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_b.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dot", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.dot", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_6dot(__pyx_self, __pyx_v_a, __pyx_v_b);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_6dot(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_a, __Pyx_memviewslice __pyx_v_b) {
  double __pyx_v_sum;
  int __pyx_v_k;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dot", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.dot", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_a, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_b, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__30 = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_n_s_a, __pyx_n_s_b, __pyx_n_s_sum, __pyx_n_s_k);<span class='error_goto'> if (unlikely(!__pyx_tuple__30)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__30);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__30);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_7dot, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_dot, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__31 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__30, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_dot, 75, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__31)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 75; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line76")'> 76:     """</pre>
<pre id='line76' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line77")'> 77:     Vector product of two vectors.</pre>
<pre id='line77' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line78")'> 78: </pre>
<pre id='line78' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line79")'> 79:     :param a: 1D numpy-array</pre>
<pre id='line79' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line80")'> 80:     :param b: 1D numpy-array</pre>
<pre id='line80' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line81")'> 81:     :return: dot-product of the two numpy arrays</pre>
<pre id='line81' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line82")'> 82:     """</pre>
<pre id='line82' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line83")'> 83:     cdef double sum = 0.0</pre>
<pre id='line83' class='code' style='background-color: #FFFFff'>  __pyx_v_sum = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line84")'> 84:     cdef int k</pre>
<pre id='line84' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line85")'> 85:     for k in xrange(a.shape[0]):</pre>
<pre id='line85' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_a.shape[0]);
  for (__pyx_t_2 = 0; __pyx_t_2 &lt; __pyx_t_1; __pyx_t_2+=1) {
    __pyx_v_k = __pyx_t_2;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line86")'> 86:         sum += a[k]*b[k]</pre>
<pre id='line86' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = __pyx_v_k;
    if (__pyx_t_3 &lt; 0) __pyx_t_3 += __pyx_v_a.shape[0];
    __pyx_t_4 = __pyx_v_k;
    if (__pyx_t_4 &lt; 0) __pyx_t_4 += __pyx_v_b.shape[0];
    __pyx_v_sum = (__pyx_v_sum + ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_3 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_4 * __pyx_v_b.strides[0]) )))));
  }
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line87")'> 87:     return sum</pre>
<pre id='line87' class='code' style='background-color: #FFFF9f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_5 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sum);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 87; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line88")'> 88: </pre>
<pre id='line88' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line89")'> 89: @cython.boundscheck(False)</pre>
<pre id='line89' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line90")'> 90: cdef inline double dot3c(double[:] a, double[:] b):</pre>
<pre id='line90' class='code' style='background-color: #FFFFff'>static CYTHON_INLINE double __pyx_f_3lib_4math_6linalg_7_vector_dot3c(__Pyx_memviewslice __pyx_v_a, __Pyx_memviewslice __pyx_v_b) {
  double __pyx_v_sum;
  int __pyx_v_k;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dot3c", 0);
/* … */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line91")'> 91:     """</pre>
<pre id='line91' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line92")'> 92:     :param a: 1D numpy-array</pre>
<pre id='line92' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line93")'> 93:     :param b: 1D numpy-array</pre>
<pre id='line93' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line94")'> 94:     :return: dot-product of the two numpy arrays</pre>
<pre id='line94' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line95")'> 95:     """</pre>
<pre id='line95' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line96")'> 96:     cdef double sum = 0.0</pre>
<pre id='line96' class='code' style='background-color: #FFFFff'>  __pyx_v_sum = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line97")'> 97:     cdef int k</pre>
<pre id='line97' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line98")'> 98:     for k in xrange(3):</pre>
<pre id='line98' class='code' style='background-color: #FFFFff'>  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 3; __pyx_t_1+=1) {
    __pyx_v_k = __pyx_t_1;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line99")'> 99:         sum += a[k]*b[k]</pre>
<pre id='line99' class='code' style='background-color: #FFFFff'>    __pyx_t_2 = __pyx_v_k;
    if (__pyx_t_2 &lt; 0) __pyx_t_2 += __pyx_v_a.shape[0];
    __pyx_t_3 = __pyx_v_k;
    if (__pyx_t_3 &lt; 0) __pyx_t_3 += __pyx_v_b.shape[0];
    __pyx_v_sum = (__pyx_v_sum + ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_2 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_3 * __pyx_v_b.strides[0]) )))));
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line100")'> 100:     return sum</pre>
<pre id='line100' class='code' style='background-color: #FFFFff'>  __pyx_r = __pyx_v_sum;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line101")'> 101: </pre>
<pre id='line101' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line102")'> 102: @cython.boundscheck(False)</pre>
<pre id='line102' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line103")'> 103: def cross(double[:] a, double[:] b):</pre>
<pre id='line103' class='code' style='background-color: #FFFF22'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_9cross(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3lib_4math_6linalg_7_vector_8cross[] = "\n    Cross-product of two vectors\n\n    :param a: numpy array of length 3\n    :param b: numpy array of length 3\n    :return: cross-product of a and b\n    ";
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_9cross = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("cross"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_9cross, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3lib_4math_6linalg_7_vector_8cross)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_9cross(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_a = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_b = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cross (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_a,&amp;__pyx_n_s_b,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_b)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cross", 1, 2, 2, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "cross") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_a = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_a.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_b = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_b.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("cross", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.cross", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_8cross(__pyx_self, __pyx_v_a, __pyx_v_b);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_8cross(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_a, __Pyx_memviewslice __pyx_v_b) {
  PyArrayObject *__pyx_v_o = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_o;
  __Pyx_Buffer __pyx_pybuffer_o;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cross", 0);
  __pyx_pybuffer_o.pybuffer.buf = NULL;
  __pyx_pybuffer_o.refcount = 0;
  __pyx_pybuffernd_o.data = NULL;
  __pyx_pybuffernd_o.rcbuffer = &amp;__pyx_pybuffer_o;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.cross", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_o);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_a, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_b, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__32 = <span class='py_c_api'>PyTuple_Pack</span>(3, __pyx_n_s_a, __pyx_n_s_b, __pyx_n_s_o);<span class='error_goto'> if (unlikely(!__pyx_tuple__32)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__32);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__32);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_9cross, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_cross, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__33 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 3, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__32, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_cross, 103, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__33)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 103; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line104")'> 104:     """</pre>
<pre id='line104' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line105")'> 105:     Cross-product of two vectors</pre>
<pre id='line105' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line106")'> 106: </pre>
<pre id='line106' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line107")'> 107:     :param a: numpy array of length 3</pre>
<pre id='line107' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line108")'> 108:     :param b: numpy array of length 3</pre>
<pre id='line108' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line109")'> 109:     :return: cross-product of a and b</pre>
<pre id='line109' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line110")'> 110:     """</pre>
<pre id='line110' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF38' onclick='toggleDiv("line111")'> 111:     cdef np.ndarray[np.float64_t, ndim=1] o = np.empty(3, dtype=np.float64)</pre>
<pre id='line111' class='code' style='background-color: #FFFF38'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_tuple_, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_o = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_o.diminfo[0].strides = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_o.diminfo[0].shape = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_o = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 111; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line112")'> 112:     o[0] = a[1]*b[2]-a[2]*b[1]</pre>
<pre id='line112' class='code' style='background-color: #FFFFff'>  __pyx_t_6 = 1;
  if (__pyx_t_6 &lt; 0) __pyx_t_6 += __pyx_v_a.shape[0];
  __pyx_t_7 = 2;
  if (__pyx_t_7 &lt; 0) __pyx_t_7 += __pyx_v_b.shape[0];
  __pyx_t_8 = 2;
  if (__pyx_t_8 &lt; 0) __pyx_t_8 += __pyx_v_a.shape[0];
  __pyx_t_9 = 1;
  if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_b.shape[0];
  __pyx_t_10 = 0;
  if (__pyx_t_10 &lt; 0) __pyx_t_10 += __pyx_pybuffernd_o.diminfo[0].shape;
  *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_o.diminfo[0].strides) = (((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_6 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_7 * __pyx_v_b.strides[0]) )))) - ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_8 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_9 * __pyx_v_b.strides[0]) )))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line113")'> 113:     o[1] = a[2]*b[0]-a[0]*b[2]</pre>
<pre id='line113' class='code' style='background-color: #FFFFff'>  __pyx_t_11 = 2;
  if (__pyx_t_11 &lt; 0) __pyx_t_11 += __pyx_v_a.shape[0];
  __pyx_t_12 = 0;
  if (__pyx_t_12 &lt; 0) __pyx_t_12 += __pyx_v_b.shape[0];
  __pyx_t_13 = 0;
  if (__pyx_t_13 &lt; 0) __pyx_t_13 += __pyx_v_a.shape[0];
  __pyx_t_14 = 2;
  if (__pyx_t_14 &lt; 0) __pyx_t_14 += __pyx_v_b.shape[0];
  __pyx_t_15 = 1;
  if (__pyx_t_15 &lt; 0) __pyx_t_15 += __pyx_pybuffernd_o.diminfo[0].shape;
  *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_o.diminfo[0].strides) = (((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_11 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_12 * __pyx_v_b.strides[0]) )))) - ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_13 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_14 * __pyx_v_b.strides[0]) )))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line114")'> 114:     o[2] = a[0]*b[1]-a[1]*b[0]</pre>
<pre id='line114' class='code' style='background-color: #FFFFff'>  __pyx_t_16 = 0;
  if (__pyx_t_16 &lt; 0) __pyx_t_16 += __pyx_v_a.shape[0];
  __pyx_t_17 = 1;
  if (__pyx_t_17 &lt; 0) __pyx_t_17 += __pyx_v_b.shape[0];
  __pyx_t_18 = 1;
  if (__pyx_t_18 &lt; 0) __pyx_t_18 += __pyx_v_a.shape[0];
  __pyx_t_19 = 0;
  if (__pyx_t_19 &lt; 0) __pyx_t_19 += __pyx_v_b.shape[0];
  __pyx_t_20 = 2;
  if (__pyx_t_20 &lt; 0) __pyx_t_20 += __pyx_pybuffernd_o.diminfo[0].shape;
  *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_o.diminfo[0].strides) = (((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_16 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_17 * __pyx_v_b.strides[0]) )))) - ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_18 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_19 * __pyx_v_b.strides[0]) )))));
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line115")'> 115:     return o</pre>
<pre id='line115' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_o));
  __pyx_r = ((PyObject *)__pyx_v_o);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line116")'> 116: </pre>
<pre id='line116' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line117")'> 117: @cython.boundscheck(False)</pre>
<pre id='line117' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line118")'> 118: cdef np.ndarray cross3c(double[:] a, double[:] b):</pre>
<pre id='line118' class='code' style='background-color: #FFFF66'>static PyArrayObject *__pyx_f_3lib_4math_6linalg_7_vector_cross3c(__Pyx_memviewslice __pyx_v_a, __Pyx_memviewslice __pyx_v_b) {
  PyArrayObject *__pyx_v_o = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_o;
  __Pyx_Buffer __pyx_pybuffer_o;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("cross3c", 0);
  __pyx_pybuffer_o.pybuffer.buf = NULL;
  __pyx_pybuffer_o.refcount = 0;
  __pyx_pybuffernd_o.data = NULL;
  __pyx_pybuffernd_o.rcbuffer = &amp;__pyx_pybuffer_o;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.cross3c", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_o);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line119")'> 119:     """</pre>
<pre id='line119' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line120")'> 120:     :param a: numpy array of length 3</pre>
<pre id='line120' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line121")'> 121:     :param b: numpy array of length 3</pre>
<pre id='line121' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line122")'> 122:     :return: cross-product of a and b</pre>
<pre id='line122' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line123")'> 123:     """</pre>
<pre id='line123' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF38' onclick='toggleDiv("line124")'> 124:     cdef np.ndarray[np.float64_t, ndim=1] o = np.empty(3, dtype=np.float64)</pre>
<pre id='line124' class='code' style='background-color: #FFFF38'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_tuple__2, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_o = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_o.diminfo[0].strides = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_o.diminfo[0].shape = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_o = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
/* … */
  __pyx_tuple__2 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_tuple__2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 124; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__2);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line125")'> 125:     o[0] = a[1]*b[2]-a[2]*b[1]</pre>
<pre id='line125' class='code' style='background-color: #FFFFff'>  __pyx_t_6 = 1;
  if (__pyx_t_6 &lt; 0) __pyx_t_6 += __pyx_v_a.shape[0];
  __pyx_t_7 = 2;
  if (__pyx_t_7 &lt; 0) __pyx_t_7 += __pyx_v_b.shape[0];
  __pyx_t_8 = 2;
  if (__pyx_t_8 &lt; 0) __pyx_t_8 += __pyx_v_a.shape[0];
  __pyx_t_9 = 1;
  if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_b.shape[0];
  __pyx_t_10 = 0;
  if (__pyx_t_10 &lt; 0) __pyx_t_10 += __pyx_pybuffernd_o.diminfo[0].shape;
  *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf, __pyx_t_10, __pyx_pybuffernd_o.diminfo[0].strides) = (((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_6 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_7 * __pyx_v_b.strides[0]) )))) - ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_8 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_9 * __pyx_v_b.strides[0]) )))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line126")'> 126:     o[1] = a[2]*b[0]-a[0]*b[2]</pre>
<pre id='line126' class='code' style='background-color: #FFFFff'>  __pyx_t_11 = 2;
  if (__pyx_t_11 &lt; 0) __pyx_t_11 += __pyx_v_a.shape[0];
  __pyx_t_12 = 0;
  if (__pyx_t_12 &lt; 0) __pyx_t_12 += __pyx_v_b.shape[0];
  __pyx_t_13 = 0;
  if (__pyx_t_13 &lt; 0) __pyx_t_13 += __pyx_v_a.shape[0];
  __pyx_t_14 = 2;
  if (__pyx_t_14 &lt; 0) __pyx_t_14 += __pyx_v_b.shape[0];
  __pyx_t_15 = 1;
  if (__pyx_t_15 &lt; 0) __pyx_t_15 += __pyx_pybuffernd_o.diminfo[0].shape;
  *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_o.diminfo[0].strides) = (((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_11 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_12 * __pyx_v_b.strides[0]) )))) - ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_13 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_14 * __pyx_v_b.strides[0]) )))));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line127")'> 127:     o[2] = a[0]*b[1]-a[1]*b[0]</pre>
<pre id='line127' class='code' style='background-color: #FFFFff'>  __pyx_t_16 = 0;
  if (__pyx_t_16 &lt; 0) __pyx_t_16 += __pyx_v_a.shape[0];
  __pyx_t_17 = 1;
  if (__pyx_t_17 &lt; 0) __pyx_t_17 += __pyx_v_b.shape[0];
  __pyx_t_18 = 1;
  if (__pyx_t_18 &lt; 0) __pyx_t_18 += __pyx_v_a.shape[0];
  __pyx_t_19 = 0;
  if (__pyx_t_19 &lt; 0) __pyx_t_19 += __pyx_v_b.shape[0];
  __pyx_t_20 = 2;
  if (__pyx_t_20 &lt; 0) __pyx_t_20 += __pyx_pybuffernd_o.diminfo[0].shape;
  *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf, __pyx_t_20, __pyx_pybuffernd_o.diminfo[0].strides) = (((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_16 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_17 * __pyx_v_b.strides[0]) )))) - ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_18 * __pyx_v_a.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_19 * __pyx_v_b.strides[0]) )))));
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line128")'> 128:     return o</pre>
<pre id='line128' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_o));
  __pyx_r = ((PyArrayObject *)__pyx_v_o);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line129")'> 129: </pre>
<pre id='line129' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line130")'> 130: @cython.boundscheck(False)</pre>
<pre id='line130' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line131")'> 131: def sub(double[:] a, double[:] b):</pre>
<pre id='line131' class='code' style='background-color: #FFFF22'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_11sub(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_11sub = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("sub"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_11sub, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_11sub(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_a = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_b = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("sub (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_a,&amp;__pyx_n_s_b,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_b)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("sub", 1, 2, 2, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "sub") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_a = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_a.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_b = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_b.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("sub", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.sub", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_10sub(__pyx_self, __pyx_v_a, __pyx_v_b);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_10sub(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_a, __Pyx_memviewslice __pyx_v_b) {
  int __pyx_v_k;
  PyArrayObject *__pyx_v_o = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_o;
  __Pyx_Buffer __pyx_pybuffer_o;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("sub", 0);
  __pyx_pybuffer_o.pybuffer.buf = NULL;
  __pyx_pybuffer_o.refcount = 0;
  __pyx_pybuffernd_o.data = NULL;
  __pyx_pybuffernd_o.rcbuffer = &amp;__pyx_pybuffer_o;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.sub", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_o);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_a, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_b, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__34 = <span class='py_c_api'>PyTuple_Pack</span>(4, __pyx_n_s_a, __pyx_n_s_b, __pyx_n_s_k, __pyx_n_s_o);<span class='error_goto'> if (unlikely(!__pyx_tuple__34)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__34);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__34);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_11sub, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_sub, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__35 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(2, 0, 4, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__34, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_sub, 131, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__35)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 131; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line132")'> 132:     cdef int k</pre>
<pre id='line132' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line133")'> 133:     cdef np.ndarray[np.float64_t, ndim=1] o = np.empty(a.shape[0], dtype=np.float64)</pre>
<pre id='line133' class='code' style='background-color: #FFFF31'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_a.shape[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_o = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 133; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_o.diminfo[0].strides = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_o.diminfo[0].shape = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_o = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line134")'> 134:     for k in xrange(a.shape[0]):</pre>
<pre id='line134' class='code' style='background-color: #FFFFff'>  __pyx_t_7 = (__pyx_v_a.shape[0]);
  for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_k = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line135")'> 135:         o[k] = a[k]-b[k]</pre>
<pre id='line135' class='code' style='background-color: #FFFFff'>    __pyx_t_9 = __pyx_v_k;
    if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_a.shape[0];
    __pyx_t_10 = __pyx_v_k;
    if (__pyx_t_10 &lt; 0) __pyx_t_10 += __pyx_v_b.shape[0];
    __pyx_t_11 = __pyx_v_k;
    if (__pyx_t_11 &lt; 0) __pyx_t_11 += __pyx_pybuffernd_o.diminfo[0].shape;
    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_o.diminfo[0].strides) = ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_9 * __pyx_v_a.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_10 * __pyx_v_b.strides[0]) ))));
  }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line136")'> 136:     return o</pre>
<pre id='line136' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_o));
  __pyx_r = ((PyObject *)__pyx_v_o);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line137")'> 137: </pre>
<pre id='line137' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line138")'> 138: @cython.boundscheck(False)</pre>
<pre id='line138' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF66' onclick='toggleDiv("line139")'> 139: cdef inline np.ndarray sub3c(double[:] a, double[:] b):</pre>
<pre id='line139' class='code' style='background-color: #FFFF66'>static CYTHON_INLINE PyArrayObject *__pyx_f_3lib_4math_6linalg_7_vector_sub3c(__Pyx_memviewslice __pyx_v_a, __Pyx_memviewslice __pyx_v_b) {
  int __pyx_v_k;
  PyArrayObject *__pyx_v_o = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_o;
  __Pyx_Buffer __pyx_pybuffer_o;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("sub3c", 0);
  __pyx_pybuffer_o.pybuffer.buf = NULL;
  __pyx_pybuffer_o.refcount = 0;
  __pyx_pybuffernd_o.data = NULL;
  __pyx_pybuffernd_o.rcbuffer = &amp;__pyx_pybuffer_o;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.sub3c", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_o);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line140")'> 140:     cdef int k</pre>
<pre id='line140' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF38' onclick='toggleDiv("line141")'> 141:     cdef np.ndarray[np.float64_t, ndim=1] o = np.empty(3, dtype=np.float64)</pre>
<pre id='line141' class='code' style='background-color: #FFFF38'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_tuple__3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_o = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_o.diminfo[0].strides = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_o.diminfo[0].shape = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_o = ((PyArrayObject *)__pyx_t_4);
  __pyx_t_4 = 0;
/* … */
  __pyx_tuple__3 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_tuple__3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 141; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__3);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line142")'> 142:     for k in xrange(3):</pre>
<pre id='line142' class='code' style='background-color: #FFFFff'>  for (__pyx_t_6 = 0; __pyx_t_6 &lt; 3; __pyx_t_6+=1) {
    __pyx_v_k = __pyx_t_6;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line143")'> 143:         o[k] = a[k]-b[k]</pre>
<pre id='line143' class='code' style='background-color: #FFFFff'>    __pyx_t_7 = __pyx_v_k;
    if (__pyx_t_7 &lt; 0) __pyx_t_7 += __pyx_v_a.shape[0];
    __pyx_t_8 = __pyx_v_k;
    if (__pyx_t_8 &lt; 0) __pyx_t_8 += __pyx_v_b.shape[0];
    __pyx_t_9 = __pyx_v_k;
    if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_pybuffernd_o.diminfo[0].shape;
    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_o.diminfo[0].strides) = ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_7 * __pyx_v_a.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_8 * __pyx_v_b.strides[0]) ))));
  }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line144")'> 144:     return o</pre>
<pre id='line144' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_o));
  __pyx_r = ((PyArrayObject *)__pyx_v_o);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line145")'> 145: </pre>
<pre id='line145' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line146")'> 146: @cython.boundscheck(False)</pre>
<pre id='line146' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF62' onclick='toggleDiv("line147")'> 147: cdef np.ndarray add(double[:] a, double[:] b):</pre>
<pre id='line147' class='code' style='background-color: #FFFF62'>static PyArrayObject *__pyx_f_3lib_4math_6linalg_7_vector_add(__Pyx_memviewslice __pyx_v_a, __Pyx_memviewslice __pyx_v_b) {
  int __pyx_v_k;
  PyArrayObject *__pyx_v_o = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_o;
  __Pyx_Buffer __pyx_pybuffer_o;
  PyArrayObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("add", 0);
  __pyx_pybuffer_o.pybuffer.buf = NULL;
  __pyx_pybuffer_o.refcount = 0;
  __pyx_pybuffernd_o.data = NULL;
  __pyx_pybuffernd_o.rcbuffer = &amp;__pyx_pybuffer_o;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.add", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_o);
  <span class='refnanny'>__Pyx_XGIVEREF</span>((PyObject *)__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line148")'> 148:     cdef int k</pre>
<pre id='line148' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF31' onclick='toggleDiv("line149")'> 149:     cdef np.ndarray[np.float64_t, ndim=1] o = np.empty(a.shape[0], dtype=np.float64)</pre>
<pre id='line149' class='code' style='background-color: #FFFF31'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_a.shape[0]));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyDict_New</span>();<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_o.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_o = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 149; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_o.diminfo[0].strides = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_o.diminfo[0].shape = __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_o = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line150")'> 150:     for k in xrange(a.shape[0]):</pre>
<pre id='line150' class='code' style='background-color: #FFFFff'>  __pyx_t_7 = (__pyx_v_a.shape[0]);
  for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
    __pyx_v_k = __pyx_t_8;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line151")'> 151:         o[k] = a[k]+b[k]</pre>
<pre id='line151' class='code' style='background-color: #FFFFff'>    __pyx_t_9 = __pyx_v_k;
    if (__pyx_t_9 &lt; 0) __pyx_t_9 += __pyx_v_a.shape[0];
    __pyx_t_10 = __pyx_v_k;
    if (__pyx_t_10 &lt; 0) __pyx_t_10 += __pyx_v_b.shape[0];
    __pyx_t_11 = __pyx_v_k;
    if (__pyx_t_11 &lt; 0) __pyx_t_11 += __pyx_pybuffernd_o.diminfo[0].shape;
    *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_o.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_o.diminfo[0].strides) = ((*((double *) ( /* dim=0 */ (__pyx_v_a.data + __pyx_t_9 * __pyx_v_a.strides[0]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_b.data + __pyx_t_10 * __pyx_v_b.strides[0]) ))));
  }
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line152")'> 152:     return o</pre>
<pre id='line152' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(((PyObject *)__pyx_r));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_o));
  __pyx_r = ((PyArrayObject *)__pyx_v_o);
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line153")'> 153: </pre>
<pre id='line153' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line154")'> 154: @cython.boundscheck(False)</pre>
<pre id='line154' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line155")'> 155: @cython.cdivision(True)</pre>
<pre id='line155' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF22' onclick='toggleDiv("line156")'> 156: def angle(double[:] a, double[:] b, double[:] c):</pre>
<pre id='line156' class='code' style='background-color: #FFFF22'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_13angle(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3lib_4math_6linalg_7_vector_12angle[] = "\n    The angle between three vectors\n\n    :param a: numpy array\n    :param b: numpy array\n    :param c: numpy array\n    :return: angle between three vectors/points in space\n    ";
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_13angle = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("angle"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_13angle, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3lib_4math_6linalg_7_vector_12angle)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_13angle(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_a = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_b = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_c = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angle (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_a,&amp;__pyx_n_s_b,&amp;__pyx_n_s_c,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_a)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_b)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle", 1, 3, 3, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_c)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle", 1, 3, 3, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "angle") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_a = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_a.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_b = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_b.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_c = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_c.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_12angle(__pyx_self, __pyx_v_a, __pyx_v_b, __pyx_v_c);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_12angle(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_a, __Pyx_memviewslice __pyx_v_b, __Pyx_memviewslice __pyx_v_c) {
  double __pyx_v_r12n;
  double __pyx_v_r23n;
  PyArrayObject *__pyx_v_r12 = NULL;
  PyArrayObject *__pyx_v_r23 = NULL;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angle", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_r12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_r23);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_a, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_b, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_c, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__36 = <span class='py_c_api'>PyTuple_Pack</span>(7, __pyx_n_s_a, __pyx_n_s_b, __pyx_n_s_c, __pyx_n_s_r12n, __pyx_n_s_r23n, __pyx_n_s_r12, __pyx_n_s_r23);<span class='error_goto'> if (unlikely(!__pyx_tuple__36)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__36);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__36);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_13angle, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_angle, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__37 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 7, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__36, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_angle, 156, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__37)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 156; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line157")'> 157:     """</pre>
<pre id='line157' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line158")'> 158:     The angle between three vectors</pre>
<pre id='line158' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line159")'> 159: </pre>
<pre id='line159' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line160")'> 160:     :param a: numpy array</pre>
<pre id='line160' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line161")'> 161:     :param b: numpy array</pre>
<pre id='line161' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line162")'> 162:     :param c: numpy array</pre>
<pre id='line162' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line163")'> 163:     :return: angle between three vectors/points in space</pre>
<pre id='line163' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line164")'> 164:     """</pre>
<pre id='line164' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line165")'> 165:     cdef double r12n, r23n</pre>
<pre id='line165' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line166")'> 166:     r12 = sub3c(a, b)</pre>
<pre id='line166' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = ((PyObject *)__pyx_f_3lib_4math_6linalg_7_vector_sub3c(__pyx_v_a, __pyx_v_b));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 166; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_r12 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line167")'> 167:     r23 = sub3c(c, b)</pre>
<pre id='line167' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = ((PyObject *)__pyx_f_3lib_4math_6linalg_7_vector_sub3c(__pyx_v_c, __pyx_v_b));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 167; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_r23 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line168")'> 168:     r12n = norm3c(r12)</pre>
<pre id='line168' class='code' style='background-color: #FFFFd4'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_r12));
  if (unlikely(!__pyx_t_2.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 168; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_r12n = __pyx_f_3lib_4math_6linalg_7_vector_norm3c(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line169")'> 169:     r23n = norm3c(r23)</pre>
<pre id='line169' class='code' style='background-color: #FFFFd4'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_r23));
  if (unlikely(!__pyx_t_2.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 169; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_r23n = __pyx_f_3lib_4math_6linalg_7_vector_norm3c(__pyx_t_2);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
</pre><pre class='line' style='background-color: #FFFF7f' onclick='toggleDiv("line170")'> 170:     return acos(dot3c(r12,r23) / (r12n*r23n) )</pre>
<pre id='line170' class='code' style='background-color: #FFFF7f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_r12));
  if (unlikely(!__pyx_t_3.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_r23));
  if (unlikely(!__pyx_t_4.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(acos((__pyx_f_3lib_4math_6linalg_7_vector_dot3c(__pyx_t_3, __pyx_t_4) / (__pyx_v_r12n * __pyx_v_r23n))));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 170; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line171")'> 171: </pre>
<pre id='line171' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line172")'> 172: @cython.cdivision(True)</pre>
<pre id='line172' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line173")'> 173: @cython.boundscheck(False)</pre>
<pre id='line173' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line174")'> 174: @cython.wraparound(False)</pre>
<pre id='line174' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF1c' onclick='toggleDiv("line175")'> 175: def dihedral(double[:] v1, double[:] v2,</pre>
<pre id='line175' class='code' style='background-color: #FFFF1c'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_15dihedral(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3lib_4math_6linalg_7_vector_14dihedral[] = "\n    Dihedral angle between four-vectors\n\n    Given the coordinates of the four points, obtain the vectors b1, b2, and b3 by vector subtraction.\n    Let me use the nonstandard notation &lt;v&gt; to denote v/|v|, the unit vector in the direction of the\n    vector v. Compute n1=&lt;b1xb2&gt; and n2=&lt;b2xb3&gt;, the normal vectors to the planes containing b1 and b2,\n    and b2 and b3 respectively. The angle we seek is the same as the angle between n1 and n2.\n\n    The three vectors n1, &lt;b2&gt;, and m1:=n1x&lt;b2&gt; form an orthonormal frame. Compute the coordinates of\n    n2 in this frame: x=n1*n2 and y=m1*n2. (You don't need to compute &lt;b2&gt;*n2 as it should always be zero.)\n\n    The dihedral angle, with the correct sign, is atan2(y,x).\n\n    (The reason I recommend the two-argument atan2 function to the traditional cos-1 in this case is both\n    because it naturally produces an angle over a range of 2pi, and because cos-1 is poorly conditioned\n    when the angle is close to 0 or +-pi.)\n\n    :param a: numpy array\n    :param b: numpy array\n    :param c: numpy array\n    :param d: numpy array\n    :return: dihedral angle between four vectors\n    ";
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_15dihedral = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("dihedral"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_15dihedral, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3lib_4math_6linalg_7_vector_14dihedral)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_15dihedral(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_v1 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_v2 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_v3 = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_v4 = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dihedral (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_v1,&amp;__pyx_n_s_v2,&amp;__pyx_n_s_v3,&amp;__pyx_n_s_v4,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_v1)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_v2)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dihedral", 1, 4, 4, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_v3)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dihedral", 1, 4, 4, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_v4)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dihedral", 1, 4, 4, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "dihedral") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_v1 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0]);<span class='error_goto'> if (unlikely(!__pyx_v_v1.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_v2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_v2.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_v3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_v3.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_v4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3]);<span class='error_goto'> if (unlikely(!__pyx_v_v4.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 176; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("dihedral", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.dihedral", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_14dihedral(__pyx_self, __pyx_v_v1, __pyx_v_v2, __pyx_v_v3, __pyx_v_v4);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_14dihedral(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_v1, __Pyx_memviewslice __pyx_v_v2, __Pyx_memviewslice __pyx_v_v3, __Pyx_memviewslice __pyx_v_v4) {
  double __pyx_v_phi;
  double __pyx_v_n1Inv;
  double __pyx_v_n2Inv;
  double __pyx_v_m1Inv;
  PyArrayObject *__pyx_v_b1 = NULL;
  PyArrayObject *__pyx_v_b2 = NULL;
  PyArrayObject *__pyx_v_b3 = NULL;
  PyArrayObject *__pyx_v_n1 = NULL;
  PyArrayObject *__pyx_v_n2 = NULL;
  PyArrayObject *__pyx_v_m1 = NULL;
  double __pyx_v_cos_phi;
  double __pyx_v_sin_phi;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("dihedral", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.dihedral", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_b1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_b2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_b3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_n1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_n2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_m1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_v1, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_v2, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_v3, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_v4, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__38 = <span class='py_c_api'>PyTuple_Pack</span>(16, __pyx_n_s_v1, __pyx_n_s_v2, __pyx_n_s_v3, __pyx_n_s_v4, __pyx_n_s_phi, __pyx_n_s_n1Inv, __pyx_n_s_n2Inv, __pyx_n_s_m1Inv, __pyx_n_s_b1, __pyx_n_s_b2, __pyx_n_s_b3, __pyx_n_s_n1, __pyx_n_s_n2, __pyx_n_s_m1, __pyx_n_s_cos_phi, __pyx_n_s_sin_phi);<span class='error_goto'> if (unlikely(!__pyx_tuple__38)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__38);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__38);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_15dihedral, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_dihedral, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__39 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 16, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_dihedral, 175, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__39)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 175; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line176")'> 176:               double[:] v3, double[:] v4):</pre>
<pre id='line176' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line177")'> 177:     """</pre>
<pre id='line177' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line178")'> 178:     Dihedral angle between four-vectors</pre>
<pre id='line178' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line179")'> 179: </pre>
<pre id='line179' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line180")'> 180:     Given the coordinates of the four points, obtain the vectors b1, b2, and b3 by vector subtraction.</pre>
<pre id='line180' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line181")'> 181:     Let me use the nonstandard notation &lt;v&gt; to denote v/|v|, the unit vector in the direction of the</pre>
<pre id='line181' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line182")'> 182:     vector v. Compute n1=&lt;b1xb2&gt; and n2=&lt;b2xb3&gt;, the normal vectors to the planes containing b1 and b2,</pre>
<pre id='line182' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line183")'> 183:     and b2 and b3 respectively. The angle we seek is the same as the angle between n1 and n2.</pre>
<pre id='line183' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line184")'> 184: </pre>
<pre id='line184' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line185")'> 185:     The three vectors n1, &lt;b2&gt;, and m1:=n1x&lt;b2&gt; form an orthonormal frame. Compute the coordinates of</pre>
<pre id='line185' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line186")'> 186:     n2 in this frame: x=n1*n2 and y=m1*n2. (You don't need to compute &lt;b2&gt;*n2 as it should always be zero.)</pre>
<pre id='line186' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line187")'> 187: </pre>
<pre id='line187' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line188")'> 188:     The dihedral angle, with the correct sign, is atan2(y,x).</pre>
<pre id='line188' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line189")'> 189: </pre>
<pre id='line189' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line190")'> 190:     (The reason I recommend the two-argument atan2 function to the traditional cos-1 in this case is both</pre>
<pre id='line190' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line191")'> 191:     because it naturally produces an angle over a range of 2pi, and because cos-1 is poorly conditioned</pre>
<pre id='line191' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line192")'> 192:     when the angle is close to 0 or +-pi.)</pre>
<pre id='line192' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line193")'> 193: </pre>
<pre id='line193' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line194")'> 194:     :param a: numpy array</pre>
<pre id='line194' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line195")'> 195:     :param b: numpy array</pre>
<pre id='line195' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line196")'> 196:     :param c: numpy array</pre>
<pre id='line196' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line197")'> 197:     :param d: numpy array</pre>
<pre id='line197' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line198")'> 198:     :return: dihedral angle between four vectors</pre>
<pre id='line198' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line199")'> 199:     """</pre>
<pre id='line199' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line200")'> 200:     # TODO: also calculate angle between vectors here: speed up calculations</pre>
<pre id='line200' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line201")'> 201:     cdef double phi, n1Inv, n2Inv, m1Inv</pre>
<pre id='line201' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line202")'> 202:     b1 = sub3c(v1, v2)</pre>
<pre id='line202' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = ((PyObject *)__pyx_f_3lib_4math_6linalg_7_vector_sub3c(__pyx_v_v1, __pyx_v_v2));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 202; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_b1 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line203")'> 203:     b2 = sub3c(v2, v3)</pre>
<pre id='line203' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = ((PyObject *)__pyx_f_3lib_4math_6linalg_7_vector_sub3c(__pyx_v_v2, __pyx_v_v3));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 203; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_b2 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line204")'> 204:     b3 = sub3c(v3, v4)</pre>
<pre id='line204' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = ((PyObject *)__pyx_f_3lib_4math_6linalg_7_vector_sub3c(__pyx_v_v3, __pyx_v_v4));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 204; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_v_b3 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line205")'> 205:     n1 = cross3c(b1, b2)</pre>
<pre id='line205' class='code' style='background-color: #FFFFb6'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_b1));
  if (unlikely(!__pyx_t_2.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_b2));
  if (unlikely(!__pyx_t_3.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = ((PyObject *)__pyx_f_3lib_4math_6linalg_7_vector_cross3c(__pyx_t_2, __pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 205; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __pyx_v_n1 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line206")'> 206:     n2 = cross3c(b2, b3)</pre>
<pre id='line206' class='code' style='background-color: #FFFFb6'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_b2));
  if (unlikely(!__pyx_t_2.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_b3));
  if (unlikely(!__pyx_t_3.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = ((PyObject *)__pyx_f_3lib_4math_6linalg_7_vector_cross3c(__pyx_t_2, __pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 206; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __pyx_v_n2 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line207")'> 207:     m1 = cross3c(b2, n1)</pre>
<pre id='line207' class='code' style='background-color: #FFFFb6'>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_b2));
  if (unlikely(!__pyx_t_2.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_n1));
  if (unlikely(!__pyx_t_3.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_1 = ((PyObject *)__pyx_f_3lib_4math_6linalg_7_vector_cross3c(__pyx_t_2, __pyx_t_3));<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 207; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_2, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __pyx_v_m1 = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line208")'> 208:     n1Inv = 1.0 / norm3c(n1)</pre>
<pre id='line208' class='code' style='background-color: #FFFFd4'>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_n1));
  if (unlikely(!__pyx_t_4.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 208; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_n1Inv = (1.0 / __pyx_f_3lib_4math_6linalg_7_vector_norm3c(__pyx_t_4));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line209")'> 209:     n2Inv = 1.0 / norm3c(n2)</pre>
<pre id='line209' class='code' style='background-color: #FFFFd4'>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_n2));
  if (unlikely(!__pyx_t_4.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 209; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_n2Inv = (1.0 / __pyx_f_3lib_4math_6linalg_7_vector_norm3c(__pyx_t_4));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line210")'> 210:     m1Inv = 1.0 / norm3c(m1)</pre>
<pre id='line210' class='code' style='background-color: #FFFFd4'>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_m1));
  if (unlikely(!__pyx_t_4.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 210; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_m1Inv = (1.0 / __pyx_f_3lib_4math_6linalg_7_vector_norm3c(__pyx_t_4));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_4, 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line211")'> 211: </pre>
<pre id='line211' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line212")'> 212:     cos_phi = dot3c(n1,n2)*(n1Inv*n2Inv)</pre>
<pre id='line212' class='code' style='background-color: #FFFFb6'>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_n1));
  if (unlikely(!__pyx_t_5.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_n2));
  if (unlikely(!__pyx_t_6.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 212; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_cos_phi = (__pyx_f_3lib_4math_6linalg_7_vector_dot3c(__pyx_t_5, __pyx_t_6) * (__pyx_v_n1Inv * __pyx_v_n2Inv));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
</pre><pre class='line' style='background-color: #FFFFb6' onclick='toggleDiv("line213")'> 213:     sin_phi = dot3c(m1,n2)*(m1Inv*n2Inv)</pre>
<pre id='line213' class='code' style='background-color: #FFFFb6'>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_m1));
  if (unlikely(!__pyx_t_5.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(((PyObject *)__pyx_v_n2));
  if (unlikely(!__pyx_t_6.memview)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 213; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_v_sin_phi = (__pyx_f_3lib_4math_6linalg_7_vector_dot3c(__pyx_t_5, __pyx_t_6) * (__pyx_v_m1Inv * __pyx_v_n2Inv));
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_5, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line214")'> 214:     if cos_phi &lt; -1: cos_phi = -1</pre>
<pre id='line214' class='code' style='background-color: #FFFFff'>  __pyx_t_7 = ((__pyx_v_cos_phi &lt; -1.0) != 0);
  if (__pyx_t_7) {
    __pyx_v_cos_phi = -1.0;
    goto __pyx_L3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line215")'> 215:     if cos_phi &gt;  1: cos_phi =  1</pre>
<pre id='line215' class='code' style='background-color: #FFFFff'>  __pyx_t_7 = ((__pyx_v_cos_phi &gt; 1.0) != 0);
  if (__pyx_t_7) {
    __pyx_v_cos_phi = 1.0;
    goto __pyx_L4;
  }
  __pyx_L4:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line216")'> 216:     if sin_phi &lt; -1: sin_phi = -1</pre>
<pre id='line216' class='code' style='background-color: #FFFFff'>  __pyx_t_7 = ((__pyx_v_sin_phi &lt; -1.0) != 0);
  if (__pyx_t_7) {
    __pyx_v_sin_phi = -1.0;
    goto __pyx_L5;
  }
  __pyx_L5:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line217")'> 217:     if sin_phi &gt;  1: sin_phi =  1</pre>
<pre id='line217' class='code' style='background-color: #FFFFff'>  __pyx_t_7 = ((__pyx_v_sin_phi &gt; 1.0) != 0);
  if (__pyx_t_7) {
    __pyx_v_sin_phi = 1.0;
    goto __pyx_L6;
  }
  __pyx_L6:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line218")'> 218:     phi= -atan2(sin_phi,cos_phi)</pre>
<pre id='line218' class='code' style='background-color: #FFFFff'>  __pyx_v_phi = (-atan2(__pyx_v_sin_phi, __pyx_v_cos_phi));
</pre><pre class='line' style='background-color: #FFFF9f' onclick='toggleDiv("line219")'> 219:     return phi</pre>
<pre id='line219' class='code' style='background-color: #FFFF9f'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_phi);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 219; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line220")'> 220: </pre>
<pre id='line220' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line221")'> 221: </pre>
<pre id='line221' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line222")'> 222: @cython.cdivision(True)</pre>
<pre id='line222' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line223")'> 223: @cython.boundscheck(False)</pre>
<pre id='line223' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line224")'> 224: @cython.wraparound(False)</pre>
<pre id='line224' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF17' onclick='toggleDiv("line225")'> 225: def solve_richardson_lucy(np.ndarray[ndim=2, dtype=np.float64_t] p, double[:] u, double[:] d, int max_iter):</pre>
<pre id='line225' class='code' style='background-color: #FFFF17'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_17solve_richardson_lucy(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_17solve_richardson_lucy = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("solve_richardson_lucy"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_17solve_richardson_lucy, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(0)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_17solve_richardson_lucy(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyArrayObject *__pyx_v_p = 0;
  __Pyx_memviewslice __pyx_v_u = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_d = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_max_iter;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("solve_richardson_lucy (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_p,&amp;__pyx_n_s_u,&amp;__pyx_n_s_d,&amp;__pyx_n_s_max_iter,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_p)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_u)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("solve_richardson_lucy", 1, 4, 4, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_d)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("solve_richardson_lucy", 1, 4, 4, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (likely((values[3] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_max_iter)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("solve_richardson_lucy", 1, 4, 4, 3); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "solve_richardson_lucy") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_p = ((PyArrayObject *)values[0]);
    __pyx_v_u = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1]);<span class='error_goto'> if (unlikely(!__pyx_v_u.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_d = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2]);<span class='error_goto'> if (unlikely(!__pyx_v_d.memview)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_max_iter = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[3]);<span class='error_goto'> if (unlikely((__pyx_v_max_iter == (int)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("solve_richardson_lucy", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.solve_richardson_lucy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!<span class='pyx_c_api'>__Pyx_ArgTypeTest</span>(((PyObject *)__pyx_v_p), __pyx_ptype_5numpy_ndarray, 1, "p", 0))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_16solve_richardson_lucy(__pyx_self, __pyx_v_p, __pyx_v_u, __pyx_v_d, __pyx_v_max_iter);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_16solve_richardson_lucy(CYTHON_UNUSED PyObject *__pyx_self, PyArrayObject *__pyx_v_p, __Pyx_memviewslice __pyx_v_u, __Pyx_memviewslice __pyx_v_d, int __pyx_v_max_iter) {
  int __pyx_v_n_i;
  int __pyx_v_n_j;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  CYTHON_UNUSED int __pyx_v_iteration;
  double __pyx_v_s;
  PyArrayObject *__pyx_v_un = 0;
  PyArrayObject *__pyx_v_c = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_c;
  __Pyx_Buffer __pyx_pybuffer_c;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_p;
  __Pyx_Buffer __pyx_pybuffer_p;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_un;
  __Pyx_Buffer __pyx_pybuffer_un;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("solve_richardson_lucy", 0);
  __pyx_pybuffer_un.pybuffer.buf = NULL;
  __pyx_pybuffer_un.refcount = 0;
  __pyx_pybuffernd_un.data = NULL;
  __pyx_pybuffernd_un.rcbuffer = &amp;__pyx_pybuffer_un;
  __pyx_pybuffer_c.pybuffer.buf = NULL;
  __pyx_pybuffer_c.refcount = 0;
  __pyx_pybuffernd_c.data = NULL;
  __pyx_pybuffernd_c.rcbuffer = &amp;__pyx_pybuffer_c;
  __pyx_pybuffer_p.pybuffer.buf = NULL;
  __pyx_pybuffer_p.refcount = 0;
  __pyx_pybuffernd_p.data = NULL;
  __pyx_pybuffernd_p.rcbuffer = &amp;__pyx_pybuffer_p;
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_p, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES, 2, 0, __pyx_stack) == -1)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  }
  __pyx_pybuffernd_p.diminfo[0].strides = __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_p.diminfo[0].shape = __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_p.diminfo[1].strides = __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_p.diminfo[1].shape = __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.shape[1];
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_c.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_un.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.solve_richardson_lucy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_c.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_p.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_un.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_un);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_c);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_u, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_d, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__40 = <span class='py_c_api'>PyTuple_Pack</span>(13, __pyx_n_s_p, __pyx_n_s_u, __pyx_n_s_d, __pyx_n_s_max_iter, __pyx_n_s_n_i, __pyx_n_s_n_j, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_iteration, __pyx_n_s_s, __pyx_n_s_un, __pyx_n_s_c);<span class='error_goto'> if (unlikely(!__pyx_tuple__40)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__40);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__40);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_17solve_richardson_lucy, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_solve_richardson_lucy, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__41 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 13, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_solve_richardson_lucy, 225, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__41)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 225; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line226")'> 226:     cdef int n_i, n_j, i, j, k, iteration</pre>
<pre id='line226' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line227")'> 227:     cdef double s</pre>
<pre id='line227' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line228")'> 228: </pre>
<pre id='line228' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line229")'> 229:     n_i = p.shape[0]</pre>
<pre id='line229' class='code' style='background-color: #FFFFff'>  __pyx_v_n_i = (__pyx_v_p-&gt;dimensions[0]);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line230")'> 230:     n_j = p.shape[1]</pre>
<pre id='line230' class='code' style='background-color: #FFFFff'>  __pyx_v_n_j = (__pyx_v_p-&gt;dimensions[1]);
</pre><pre class='line' style='background-color: #FFFF55' onclick='toggleDiv("line231")'> 231:     cdef np.ndarray[ndim=1, dtype=np.float64_t] un = np.copy(u)</pre>
<pre id='line231' class='code' style='background-color: #FFFF55'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_u, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_4 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_un.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_4, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_un = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_un.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 231; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_un.diminfo[0].strides = __pyx_pybuffernd_un.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_un.diminfo[0].shape = __pyx_pybuffernd_un.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_4 = 0;
  __pyx_v_un = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFF4f' onclick='toggleDiv("line232")'> 232:     cdef np.ndarray[ndim=1, dtype=np.float64_t] c = np.zeros(n_i)</pre>
<pre id='line232' class='code' style='background-color: #FFFF4f'>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_n_i);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (!(likely(((__pyx_t_1) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_1, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_5 = ((PyArrayObject *)__pyx_t_1);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_c.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_5, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_c = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_c.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 232; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_c.diminfo[0].strides = __pyx_pybuffernd_c.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_c.diminfo[0].shape = __pyx_pybuffernd_c.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_5 = 0;
  __pyx_v_c = ((PyArrayObject *)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line233")'> 233: </pre>
<pre id='line233' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line234")'> 234:     for iteration in range(max_iter):</pre>
<pre id='line234' class='code' style='background-color: #FFFFff'>  __pyx_t_6 = __pyx_v_max_iter;
  for (__pyx_t_7 = 0; __pyx_t_7 &lt; __pyx_t_6; __pyx_t_7+=1) {
    __pyx_v_iteration = __pyx_t_7;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line235")'> 235: </pre>
<pre id='line235' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line236")'> 236:         for i in prange(n_i, nogil=True):</pre>
<pre id='line236' class='code' style='background-color: #FFFFff'>    {
        #ifdef WITH_THREAD
        PyThreadState *_save;
        Py_UNBLOCK_THREADS
        #endif
        /*try:*/ {
          __pyx_t_8 = __pyx_v_n_i;
          if (1 == 0) abort();
          {
              #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                  #undef likely
                  #undef unlikely
                  #define likely(x)   (x)
                  #define unlikely(x) (x)
              #endif
              __pyx_t_10 = (__pyx_t_8 - 0) / 1;
              if (__pyx_t_10 &gt; 0)
              {
                  #ifdef _OPENMP
                  #pragma omp parallel
                  #endif /* _OPENMP */
                  {
                      #ifdef _OPENMP
                      #pragma omp for lastprivate(__pyx_v_k) firstprivate(__pyx_v_i) lastprivate(__pyx_v_i)
                      #endif /* _OPENMP */
                      for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_10; __pyx_t_9++){
                          {
                              __pyx_v_i = 0 + 1 * __pyx_t_9;
                              /* Initialize private variables to invalid values */
                              __pyx_v_k = ((int)0xbad0bad0);
/* … */
        /*finally:*/ {
          /*normal exit:*/{
            #ifdef WITH_THREAD
            Py_BLOCK_THREADS
            #endif
            goto __pyx_L9;
          }
          __pyx_L9:;
        }
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line237")'> 237:             c[i] = 0.0</pre>
<pre id='line237' class='code' style='background-color: #FFFFff'>                              __pyx_t_11 = __pyx_v_i;
                              *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_c.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_c.diminfo[0].strides) = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line238")'> 238:             for k in range(n_j):</pre>
<pre id='line238' class='code' style='background-color: #FFFFff'>                              __pyx_t_12 = __pyx_v_n_j;
                              for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_12; __pyx_t_13+=1) {
                                __pyx_v_k = __pyx_t_13;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line239")'> 239:                 c[i] += p[i, k] * u[k]</pre>
<pre id='line239' class='code' style='background-color: #FFFFff'>                                __pyx_t_14 = __pyx_v_i;
                                __pyx_t_15 = __pyx_v_k;
                                __pyx_t_16 = __pyx_v_k;
                                __pyx_t_17 = __pyx_v_i;
                                *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_c.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_c.diminfo[0].strides) += ((*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.buf, __pyx_t_14, __pyx_pybuffernd_p.diminfo[0].strides, __pyx_t_15, __pyx_pybuffernd_p.diminfo[1].strides)) * (*((double *) ( /* dim=0 */ (__pyx_v_u.data + __pyx_t_16 * __pyx_v_u.strides[0]) ))));
                              }
                          }
                      }
                  }
              }
          }
          #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
              #undef likely
              #undef unlikely
              #define likely(x)   __builtin_expect(!!(x), 1)
              #define unlikely(x) __builtin_expect(!!(x), 0)
          #endif
        }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line240")'> 240: </pre>
<pre id='line240' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line241")'> 241:         for j in range(n_j):</pre>
<pre id='line241' class='code' style='background-color: #FFFFff'>    __pyx_t_10 = __pyx_v_n_j;
    for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_10; __pyx_t_9+=1) {
      __pyx_v_j = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line242")'> 242:             s = 0.0</pre>
<pre id='line242' class='code' style='background-color: #FFFFff'>      __pyx_v_s = 0.0;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line243")'> 243:             for i in range(n_i):</pre>
<pre id='line243' class='code' style='background-color: #FFFFff'>      __pyx_t_8 = __pyx_v_n_i;
      for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_8; __pyx_t_12+=1) {
        __pyx_v_i = __pyx_t_12;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line244")'> 244:                 s += d[i] / c[i] * p[i, j]</pre>
<pre id='line244' class='code' style='background-color: #FFFFff'>        __pyx_t_13 = __pyx_v_i;
        __pyx_t_18 = __pyx_v_i;
        __pyx_t_19 = __pyx_v_i;
        __pyx_t_20 = __pyx_v_j;
        __pyx_v_s = (__pyx_v_s + (((*((double *) ( /* dim=0 */ (__pyx_v_d.data + __pyx_t_13 * __pyx_v_d.strides[0]) ))) / (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_c.rcbuffer-&gt;pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_c.diminfo[0].strides))) * (*__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_p.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_p.diminfo[0].strides, __pyx_t_20, __pyx_pybuffernd_p.diminfo[1].strides))));
      }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line245")'> 245:             un[j] = u[j] * s</pre>
<pre id='line245' class='code' style='background-color: #FFFFff'>      __pyx_t_8 = __pyx_v_j;
      __pyx_t_12 = __pyx_v_j;
      *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_un.rcbuffer-&gt;pybuffer.buf, __pyx_t_12, __pyx_pybuffernd_un.diminfo[0].strides) = ((*((double *) ( /* dim=0 */ (__pyx_v_u.data + __pyx_t_8 * __pyx_v_u.strides[0]) ))) * __pyx_v_s);
    }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line246")'> 246:         for j in range(n_j):</pre>
<pre id='line246' class='code' style='background-color: #FFFFff'>    __pyx_t_10 = __pyx_v_n_j;
    for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_10; __pyx_t_9+=1) {
      __pyx_v_j = __pyx_t_9;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line247")'> 247:             u[j] = un[j]</pre>
<pre id='line247' class='code' style='background-color: #FFFFff'>      __pyx_t_21 = __pyx_v_j;
      __pyx_t_22 = __pyx_v_j;
      *((double *) ( /* dim=0 */ (__pyx_v_u.data + __pyx_t_22 * __pyx_v_u.strides[0]) )) = (*__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_un.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_un.diminfo[0].strides));
    }
  }
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line248")'> 248: </pre>
<pre id='line248' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line249")'> 249: </pre>
<pre id='line249' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line250")'> 250: @cython.boundscheck(False)</pre>
<pre id='line250' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line251")'> 251: @cython.wraparound(False)</pre>
<pre id='line251' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF19' onclick='toggleDiv("line252")'> 252: def euler_matrix(double psi, double theta, double phi, approx=False):</pre>
<pre id='line252' class='code' style='background-color: #FFFF19'>/* Python wrapper */
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_19euler_matrix(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_3lib_4math_6linalg_7_vector_18euler_matrix[] = "Return homogeneous rotation matrix from Euler angles psi, theta and phi\n\n    Here the Euler-angles are defined according to DIN 9300. For small angles the Trigonometric functions can be\n    approximated by the first order if the parameter approx is True.\n\n    :param psi: double\n        yaw-angle\n    :param theta: double\n        pitch-angle\n    :param phi: double\n        yaw-angle\n    :param approx: bool\n\n    ";
static PyMethodDef __pyx_mdef_3lib_4math_6linalg_7_vector_19euler_matrix = {<span class='pyx_macro_api'>__Pyx_NAMESTR</span>("euler_matrix"), (PyCFunction)__pyx_pw_3lib_4math_6linalg_7_vector_19euler_matrix, METH_VARARGS|METH_KEYWORDS, <span class='pyx_macro_api'>__Pyx_DOCSTR</span>(__pyx_doc_3lib_4math_6linalg_7_vector_18euler_matrix)};
static PyObject *__pyx_pw_3lib_4math_6linalg_7_vector_19euler_matrix(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  double __pyx_v_psi;
  double __pyx_v_theta;
  double __pyx_v_phi;
  PyObject *__pyx_v_approx = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("euler_matrix (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_psi,&amp;__pyx_n_s_theta,&amp;__pyx_n_s_phi,&amp;__pyx_n_s_approx,0};
    PyObject* values[4] = {0,0,0,0};
    values[3] = ((PyObject *)Py_False);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_psi)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        case  1:
        if (likely((values[1] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_theta)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("euler_matrix", 0, 3, 4, 1); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  2:
        if (likely((values[2] = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_phi)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("euler_matrix", 0, 3, 4, 2); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
        }
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='py_c_api'>PyDict_GetItem</span>(__pyx_kwds, __pyx_n_s_approx);
          if (value) { values[3] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "euler_matrix") &lt; 0)) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_psi = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[0]);<span class='error_goto'> if (unlikely((__pyx_v_psi == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_theta = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[1]);<span class='error_goto'> if (unlikely((__pyx_v_theta == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_phi = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]);<span class='error_goto'> if (unlikely((__pyx_v_phi == (double)-1) &amp;&amp; PyErr_Occurred())) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
    __pyx_v_approx = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("euler_matrix", 0, 3, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L3_error;}</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.euler_matrix", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_3lib_4math_6linalg_7_vector_18euler_matrix(__pyx_self, __pyx_v_psi, __pyx_v_theta, __pyx_v_phi, __pyx_v_approx);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_3lib_4math_6linalg_7_vector_18euler_matrix(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_psi, double __pyx_v_theta, double __pyx_v_phi, PyObject *__pyx_v_approx) {
  double __pyx_v_sin_psi;
  double __pyx_v_sin_theta;
  double __pyx_v_sin_phi;
  double __pyx_v_cos_psi;
  double __pyx_v_cos_theta;
  double __pyx_v_cos_phi;
  PyArrayObject *__pyx_v_M = 0;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_M;
  __Pyx_Buffer __pyx_pybuffer_M;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("euler_matrix", 0);
  __pyx_pybuffer_M.pybuffer.buf = NULL;
  __pyx_pybuffer_M.refcount = 0;
  __pyx_pybuffernd_M.data = NULL;
  __pyx_pybuffernd_M.rcbuffer = &amp;__pyx_pybuffer_M;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_M.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("lib.math.linalg._vector.euler_matrix", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_M.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_M);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
  __pyx_tuple__42 = <span class='py_c_api'>PyTuple_Pack</span>(11, __pyx_n_s_psi, __pyx_n_s_theta, __pyx_n_s_phi, __pyx_n_s_approx, __pyx_n_s_sin_psi, __pyx_n_s_sin_theta, __pyx_n_s_sin_phi, __pyx_n_s_cos_psi, __pyx_n_s_cos_theta, __pyx_n_s_cos_phi, __pyx_n_s_M);<span class='error_goto'> if (unlikely(!__pyx_tuple__42)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__42);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__42);
/* … */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_3lib_4math_6linalg_7_vector_19euler_matrix, NULL, __pyx_n_s_lib_math_linalg__vector);<span class='error_goto'> if (unlikely(!__pyx_t_1)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_euler_matrix, __pyx_t_1) &lt; 0) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__43 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 11, 0, 0, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__42, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Y_Documents_ChiSurf_devel_lib_ma, __pyx_n_s_euler_matrix, 252, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__43)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 252; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line253")'> 253:     """Return homogeneous rotation matrix from Euler angles psi, theta and phi</pre>
<pre id='line253' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line254")'> 254: </pre>
<pre id='line254' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line255")'> 255:     Here the Euler-angles are defined according to DIN 9300. For small angles the Trigonometric functions can be</pre>
<pre id='line255' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line256")'> 256:     approximated by the first order if the parameter approx is True.</pre>
<pre id='line256' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line257")'> 257: </pre>
<pre id='line257' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line258")'> 258:     :param psi: double</pre>
<pre id='line258' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line259")'> 259:         yaw-angle</pre>
<pre id='line259' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line260")'> 260:     :param theta: double</pre>
<pre id='line260' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line261")'> 261:         pitch-angle</pre>
<pre id='line261' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line262")'> 262:     :param phi: double</pre>
<pre id='line262' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line263")'> 263:         yaw-angle</pre>
<pre id='line263' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line264")'> 264:     :param approx: bool</pre>
<pre id='line264' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line265")'> 265: </pre>
<pre id='line265' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line266")'> 266:     """</pre>
<pre id='line266' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line267")'> 267:     cdef double sin_psi, sin_theta, sin_phi</pre>
<pre id='line267' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line268")'> 268:     cdef double cos_psi, cos_theta, cos_phi</pre>
<pre id='line268' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line269")'> 269: </pre>
<pre id='line269' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line270")'> 270:     if approx is False:</pre>
<pre id='line270' class='code' style='background-color: #FFFFff'>  __pyx_t_1 = (__pyx_v_approx == Py_False);
  __pyx_t_2 = (__pyx_t_1 != 0);
  if (__pyx_t_2) {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line271")'> 271:         sin_psi, sin_theta, sin_phi = sin(psi), sin(theta), sin(phi)</pre>
<pre id='line271' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = sin(__pyx_v_psi);
    __pyx_t_4 = sin(__pyx_v_theta);
    __pyx_t_5 = sin(__pyx_v_phi);
    __pyx_v_sin_psi = __pyx_t_3;
    __pyx_v_sin_theta = __pyx_t_4;
    __pyx_v_sin_phi = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line272")'> 272:         cos_psi, cos_theta, cos_phi = cos(psi), cos(theta), cos(phi)</pre>
<pre id='line272' class='code' style='background-color: #FFFFff'>    __pyx_t_5 = cos(__pyx_v_psi);
    __pyx_t_4 = cos(__pyx_v_theta);
    __pyx_t_3 = cos(__pyx_v_phi);
    __pyx_v_cos_psi = __pyx_t_5;
    __pyx_v_cos_theta = __pyx_t_4;
    __pyx_v_cos_phi = __pyx_t_3;
    goto __pyx_L3;
  }
  /*else*/ {
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line273")'> 273:     else:</pre>
<pre id='line273' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line274")'> 274:         sin_psi, sin_theta, sin_phi = psi, theta, phi</pre>
<pre id='line274' class='code' style='background-color: #FFFFff'>    __pyx_t_3 = __pyx_v_psi;
    __pyx_t_4 = __pyx_v_theta;
    __pyx_t_5 = __pyx_v_phi;
    __pyx_v_sin_psi = __pyx_t_3;
    __pyx_v_sin_theta = __pyx_t_4;
    __pyx_v_sin_phi = __pyx_t_5;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line275")'> 275:         cos_psi, cos_theta, cos_phi = 1-abs(psi), 1-abs(theta), 1-abs(phi)</pre>
<pre id='line275' class='code' style='background-color: #FFFFff'>    __pyx_t_5 = (1.0 - fabs(__pyx_v_psi));
    __pyx_t_4 = (1.0 - fabs(__pyx_v_theta));
    __pyx_t_3 = (1.0 - fabs(__pyx_v_phi));
    __pyx_v_cos_psi = __pyx_t_5;
    __pyx_v_cos_theta = __pyx_t_4;
    __pyx_v_cos_phi = __pyx_t_3;
  }
  __pyx_L3:;
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line276")'> 276: </pre>
<pre id='line276' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFF5b' onclick='toggleDiv("line277")'> 277:     cdef np.ndarray[dtype=np.float64_t, ndim=2] M = np.identity(3)</pre>
<pre id='line277' class='code' style='background-color: #FFFF5b'>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_identity);<span class='error_goto'> if (unlikely(!__pyx_t_7)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_7, __pyx_tuple__4, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_6)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_6) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_6, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_6);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_M.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_M = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>{__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
    } else {__pyx_pybuffernd_M.diminfo[0].strides = __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_M.diminfo[0].shape = __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_M.diminfo[1].strides = __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_M.diminfo[1].shape = __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_8 = 0;
  __pyx_v_M = ((PyArrayObject *)__pyx_t_6);
  __pyx_t_6 = 0;
/* … */
  __pyx_tuple__4 = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_int_3);<span class='error_goto'> if (unlikely(!__pyx_tuple__4)) {__pyx_filename = __pyx_f[0]; __pyx_lineno = 277; __pyx_clineno = __LINE__; goto __pyx_L1_error;}</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__4);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line278")'> 278: </pre>
<pre id='line278' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line279")'> 279:     M[0, 0] =  cos_theta * cos_psi</pre>
<pre id='line279' class='code' style='background-color: #FFFFff'>  __pyx_t_9 = 0;
  __pyx_t_10 = 0;
  *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf, __pyx_t_9, __pyx_pybuffernd_M.diminfo[0].strides, __pyx_t_10, __pyx_pybuffernd_M.diminfo[1].strides) = (__pyx_v_cos_theta * __pyx_v_cos_psi);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line280")'> 280:     M[0, 1] =  cos_theta * sin_psi</pre>
<pre id='line280' class='code' style='background-color: #FFFFff'>  __pyx_t_11 = 0;
  __pyx_t_12 = 1;
  *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf, __pyx_t_11, __pyx_pybuffernd_M.diminfo[0].strides, __pyx_t_12, __pyx_pybuffernd_M.diminfo[1].strides) = (__pyx_v_cos_theta * __pyx_v_sin_psi);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line281")'> 281:     M[0, 2] = -sin_theta</pre>
<pre id='line281' class='code' style='background-color: #FFFFff'>  __pyx_t_13 = 0;
  __pyx_t_14 = 2;
  *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf, __pyx_t_13, __pyx_pybuffernd_M.diminfo[0].strides, __pyx_t_14, __pyx_pybuffernd_M.diminfo[1].strides) = (-__pyx_v_sin_theta);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line282")'> 282: </pre>
<pre id='line282' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line283")'> 283:     M[1, 0] = sin_phi * sin_theta * cos_psi - cos_phi * sin_psi</pre>
<pre id='line283' class='code' style='background-color: #FFFFff'>  __pyx_t_15 = 1;
  __pyx_t_16 = 0;
  *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_M.diminfo[0].strides, __pyx_t_16, __pyx_pybuffernd_M.diminfo[1].strides) = (((__pyx_v_sin_phi * __pyx_v_sin_theta) * __pyx_v_cos_psi) - (__pyx_v_cos_phi * __pyx_v_sin_psi));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line284")'> 284:     M[1, 1] = sin_phi * sin_theta * sin_psi + cos_phi * cos_psi</pre>
<pre id='line284' class='code' style='background-color: #FFFFff'>  __pyx_t_17 = 1;
  __pyx_t_18 = 1;
  *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_M.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_M.diminfo[1].strides) = (((__pyx_v_sin_phi * __pyx_v_sin_theta) * __pyx_v_sin_psi) + (__pyx_v_cos_phi * __pyx_v_cos_psi));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line285")'> 285:     M[1, 2] = sin_phi * cos_theta</pre>
<pre id='line285' class='code' style='background-color: #FFFFff'>  __pyx_t_19 = 1;
  __pyx_t_20 = 2;
  *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf, __pyx_t_19, __pyx_pybuffernd_M.diminfo[0].strides, __pyx_t_20, __pyx_pybuffernd_M.diminfo[1].strides) = (__pyx_v_sin_phi * __pyx_v_cos_theta);
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line286")'> 286: </pre>
<pre id='line286' class='code' style='background-color: #FFFFff'></pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line287")'> 287:     M[2, 0] = cos_phi * sin_theta * cos_psi + sin_phi * sin_psi</pre>
<pre id='line287' class='code' style='background-color: #FFFFff'>  __pyx_t_21 = 2;
  __pyx_t_22 = 0;
  *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf, __pyx_t_21, __pyx_pybuffernd_M.diminfo[0].strides, __pyx_t_22, __pyx_pybuffernd_M.diminfo[1].strides) = (((__pyx_v_cos_phi * __pyx_v_sin_theta) * __pyx_v_cos_psi) + (__pyx_v_sin_phi * __pyx_v_sin_psi));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line288")'> 288:     M[2, 1] = cos_phi * sin_theta * sin_psi - sin_phi * cos_psi</pre>
<pre id='line288' class='code' style='background-color: #FFFFff'>  __pyx_t_23 = 2;
  __pyx_t_24 = 1;
  *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf, __pyx_t_23, __pyx_pybuffernd_M.diminfo[0].strides, __pyx_t_24, __pyx_pybuffernd_M.diminfo[1].strides) = (((__pyx_v_cos_phi * __pyx_v_sin_theta) * __pyx_v_sin_psi) - (__pyx_v_sin_phi * __pyx_v_cos_psi));
</pre><pre class='line' style='background-color: #FFFFff' onclick='toggleDiv("line289")'> 289:     M[2, 2] = cos_phi * cos_theta</pre>
<pre id='line289' class='code' style='background-color: #FFFFff'>  __pyx_t_25 = 2;
  __pyx_t_26 = 2;
  *__Pyx_BufPtrStrided2d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_M.rcbuffer-&gt;pybuffer.buf, __pyx_t_25, __pyx_pybuffernd_M.diminfo[0].strides, __pyx_t_26, __pyx_pybuffernd_M.diminfo[1].strides) = (__pyx_v_cos_phi * __pyx_v_cos_theta);
</pre><pre class='line' style='background-color: #FFFFd4' onclick='toggleDiv("line290")'> 290:     return M</pre>
<pre id='line290' class='code' style='background-color: #FFFFd4'>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_M));
  __pyx_r = ((PyObject *)__pyx_v_M);
  goto __pyx_L0;
</pre></body></html>
